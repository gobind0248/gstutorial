name: Deploy to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Pages
        uses: actions/configure-pages@v4
        
      - name: Create missing files
        run: |
          # Create classes.json if missing
          if [ ! -f "classes.json" ]; then
            echo '[
              {
                "id": "8",
                "name": "Class 8",
                "icon": "ðŸ“š",
                "description": "Mathematics & Science",
                "subjects": [
                  {
                    "id": "mathematics",
                    "name": "Mathematics",
                    "icon": "ðŸ“",
                    "description": "Algebra, Geometry, Mensuration"
                  },
                  {
                    "id": "science",
                    "name": "Science",
                    "icon": "ðŸ”¬",
                    "description": "Physics, Chemistry, Biology"
                  }
                ]
              }
            ]' > classes.json
          fi
          
          # Create service-worker.js if missing
          if [ ! -f "service-worker.js" ]; then
            echo '// Service Worker for G.S. Tutorial
const CACHE_NAME = "gs-tutorial-cache-v1";
self.addEventListener("install", () => self.skipWaiting());
self.addEventListener("activate", () => self.clients.claim());
self.addEventListener("fetch", (event) => {
  event.respondWith(fetch(event.request));
});' > service-worker.js
          fi
          
          # Create manifest.json if missing
          if [ ! -f "manifest.json" ]; then
            echo '{
              "name": "G.S. Tutorial",
              "short_name": "G.S. Tutorial",
              "start_url": "./index.html",
              "display": "standalone",
              "background_color": "#0f172a",
              "theme_color": "#0f172a",
              "icons": []
            }' > manifest.json
          fi
          
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
          
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
