<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G.S. Tutorial - Classes 8, 9, 10</title>
    <style>
        /* ===== CSS RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }

        :root {
            --primary-blue: #3b82f6;
            --primary-green: #22c55e;
            --primary-yellow: #f59e0b;
            --primary-purple: #8b5cf6;
            --primary-red: #ef4444;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-border: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1f35 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ===== FIXED HEADER ===== */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--dark-border);
            z-index: 1000;
            padding: 15px 20px;
            display: none;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            flex: 1;
            min-width: 200px;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-creator {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-name-display {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .user-class-badge {
            background: rgba(245, 158, 11, 0.2);
            color: var(--primary-yellow);
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 100px;
        }

        /* ===== SCREEN MANAGER ===== */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ===== LOGIN SCREEN ===== */
        #login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 440px;
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-xl), 0 0 40px rgba(59, 130, 246, 0.1);
            overflow: hidden;
        }

        .login-header {
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s infinite linear;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .logo {
            position: relative;
            z-index: 1;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ffffff 0%, #e2e8f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .login-form {
            padding: 40px 30px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(15, 23, 42, 0.7);
            border: 2px solid var(--dark-border);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
            background: rgba(15, 23, 42, 0.9);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .password-container {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .toggle-password:hover {
            color: var(--primary-blue);
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 24px;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-blue) 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(90deg, var(--primary-green) 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }

        .btn-danger {
            background: linear-gradient(90deg, var(--primary-red) 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .btn-warning {
            background: linear-gradient(90deg, var(--primary-yellow) 0%, #d97706 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--dark-border);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary-blue);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn:disabled:hover::before {
            width: 0;
            height: 0;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
            padding: 16px;
            border-radius: var(--radius-md);
            border: 1px solid rgba(239, 68, 68, 0.3);
            margin-top: 20px;
            display: none;
            font-size: 0.95rem;
        }

        /* ===== SELECTION SCREEN ===== */
        #selection-screen {
            min-height: calc(100vh - 100px);
        }

        .selection-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }

        .selection-header h2 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-message {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .user-name-highlight {
            color: var(--primary-green);
            font-weight: 700;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .selection-card {
            background: var(--dark-card);
            border: 2px solid var(--dark-border);
            border-radius: var(--radius-xl);
            padding: 30px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .selection-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .selection-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-blue);
            box-shadow: var(--shadow-xl);
        }

        .selection-card:hover::before {
            transform: scaleX(1);
        }

        .selection-card.selected {
            border-color: var(--primary-green);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(30, 41, 59, 0.9) 100%);
        }

        .selection-card.selected::before {
            transform: scaleX(1);
            background: linear-gradient(90deg, var(--primary-green) 0%, #16a34a 100%);
        }

        .selection-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            display: inline-block;
            transition: var(--transition);
        }

        .selection-card:hover .selection-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .selection-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .selection-card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .selection-footer {
            text-align: center;
            margin-top: 40px;
        }

        .btn-continue {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ===== QUIZ SCREEN ===== */
        #quiz-screen {
            min-height: calc(100vh - 100px);
        }

        .quiz-title-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--dark-border);
        }

        .quiz-title-section h2 {
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .quiz-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .chapter-card {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: var(--radius-xl);
            padding: 25px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .chapter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--primary-green) 100%);
        }

        .chapter-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary-blue);
            box-shadow: var(--shadow-xl);
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chapter-title {
            font-size: 1.3rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .chapter-badge {
            background: rgba(245, 158, 11, 0.2);
            color: var(--primary-yellow);
            padding: 6px 14px;
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 600;
        }

        .chapter-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .chapter-description {
            color: var(--text-secondary);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .btn-start-chapter {
            width: 100%;
        }

        /* ===== QUIZ QUESTION SCREEN ===== */
        #quiz-question-screen {
            min-height: calc(100vh - 100px);
        }

        .quiz-progress-container {
            background: var(--dark-card);
            border-radius: var(--radius-xl);
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--dark-border);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .progress-title {
            font-size: 1.2rem;
            color: var(--text-primary);
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(15, 23, 42, 0.7);
            padding: 8px 16px;
            border-radius: var(--radius-full);
            border: 1px solid var(--dark-border);
        }

        .timer-warning {
            color: var(--warning);
            animation: pulse 1s infinite;
        }

        .timer-critical {
            color: var(--danger);
            animation: pulse 0.5s infinite;
        }

        .progress-bar {
            height: 8px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: var(--radius-full);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-container {
            background: var(--dark-card);
            border-radius: var(--radius-xl);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--dark-border);
        }

        .question-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--dark-border);
            flex-wrap: wrap;
        }

        .question-number {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-purple) 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .question-chapter {
            flex: 1;
            font-size: 1.1rem;
            color: var(--text-primary);
            min-width: 200px;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.7;
            color: var(--text-primary);
            margin-bottom: 30px;
        }

        .options-container {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            background: rgba(15, 23, 42, 0.7);
            border: 2px solid var(--dark-border);
            border-radius: var(--radius-lg);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .option:hover {
            border-color: var(--primary-blue);
            transform: translateX(5px);
        }

        .option:hover::before {
            opacity: 1;
        }

        .option.selected {
            border-color: var(--primary-blue);
            background: rgba(59, 130, 246, 0.15);
        }

        .option.correct {
            border-color: var(--primary-green);
            background: rgba(34, 197, 94, 0.15);
        }

        .option.incorrect {
            border-color: var(--primary-red);
            background: rgba(239, 68, 68, 0.15);
        }

        .option-label {
            width: 40px;
            height: 40px;
            background: var(--dark-border);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            flex-shrink: 0;
            z-index: 1;
        }

        .option.selected .option-label {
            background: var(--primary-blue);
            color: white;
        }

        .option.correct .option-label {
            background: var(--primary-green);
            color: white;
        }

        .option.incorrect .option-label {
            background: var(--primary-red);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 1.1rem;
            color: var(--text-primary);
            z-index: 1;
        }

        .explanation-box {
            background: rgba(15, 23, 42, 0.7);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid var(--primary-blue);
            display: none;
            animation: slideInRight 0.3s ease;
        }

        .explanation-title {
            color: var(--primary-blue);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-text {
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 1.05rem;
        }

        .quiz-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .quiz-controls {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .quiz-controls {
                grid-template-columns: 1fr;
            }
        }

        /* ===== RESULTS SCREEN ===== */
        #results-screen {
            min-height: calc(100vh - 100px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .results-container {
            width: 100%;
            max-width: 600px;
            background: var(--dark-card);
            border-radius: var(--radius-2xl);
            padding: 40px;
            border: 1px solid var(--dark-border);
            box-shadow: var(--shadow-xl);
            animation: fadeIn 0.5s ease;
        }

        .results-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .results-title {
            font-size: 2.2rem;
            background: linear-gradient(90deg, var(--primary-blue) 0%, var(--primary-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .results-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .score-display {
            text-align: center;
            margin-bottom: 40px;
        }

        .score-circle-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
        }

        .score-circle-bg {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--primary-green) 0% var(--percentage, 0%), var(--dark-border) 0%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score-circle-bg::before {
            content: '';
            position: absolute;
            width: 160px;
            height: 160px;
            background: var(--dark-card);
            border-radius: 50%;
        }

        .score-value {
            position: relative;
            z-index: 1;
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-green);
            margin-bottom: 5px;
        }

        .score-percentage {
            position: relative;
            z-index: 1;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.7);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--dark-border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .results-message {
            background: rgba(59, 130, 246, 0.1);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-bottom: 40px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            text-align: center;
        }

        .message-text {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .message-subtext {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .results-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        @media (max-width: 480px) {
            .results-actions {
                grid-template-columns: 1fr;
            }
        }

        /* ===== LOADER ===== */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loader.active {
            display: flex;
        }

        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--dark-border);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loader-text {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .main-header {
                padding: 12px 15px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .header-left {
                min-width: auto;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
            
            .container {
                padding: 15px;
                padding-top: 150px;
            }

            .login-container {
                margin: 0 15px;
            }

            .selection-grid {
                grid-template-columns: 1fr;
            }

            .chapters-grid {
                grid-template-columns: 1fr;
            }

            .question-text {
                font-size: 1.2rem;
            }

            .option {
                padding: 15px;
            }

            .results-container {
                padding: 25px;
                margin: 0 15px;
            }

            .results-stats {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 14px 18px;
            }
        }

        @media (max-width: 480px) {
            .logo h1 {
                font-size: 2rem;
            }

            .login-form {
                padding: 30px 20px;
            }

            .selection-header h2 {
                font-size: 1.8rem;
            }

            .chapter-card {
                padding: 20px;
            }

            .question-container {
                padding: 20px;
            }

            .option {
                padding: 12px;
            }

            .option-label {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            .option-text {
                font-size: 1rem;
            }
            
            .app-title {
                font-size: 1.3rem;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .mb-10 { margin-bottom: 10px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .p-20 { padding: 20px; }
        .p-30 { padding: 30px; }
        .hidden { display: none !important; }
        .visible { display: block !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-10 { gap: 10px; }
        .gap-20 { gap: 20px; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
    </style>
</head>
<body>
    <!-- ===== FIXED HEADER ===== -->
    <header class="main-header" id="main-header">
        <div class="header-content">
            <div class="header-left">
                <div class="app-title">G.S. Tutorial</div>
                <div class="app-creator">App created by Gobind Sharma</div>
            </div>
            <div class="user-info">
                <div class="user-name-display">
                    <span>üë§</span>
                    <span id="header-user-name">Guest</span>
                    <span class="user-class-badge" id="header-user-class">Class 0</span>
                </div>
                <button id="header-logout-btn" class="btn btn-danger">
                    <span>üö™</span>
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </header>

    <!-- ===== LOADER ===== -->
    <div id="loader" class="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Loading...</div>
    </div>

    <!-- ===== LOGIN SCREEN ===== -->
    <div id="login-screen" class="screen active">
        <div class="container">
            <div class="login-container">
                <div class="login-header">
                    <div class="logo">
                        <h1>G.S. Tutorial</h1>
                        <p>Classes 8, 9 & 10 ‚Ä¢ Science & Mathematics</p>
                    </div>
                </div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label class="form-label">
                            <span>üë§</span>
                            <span>Username</span>
                        </label>
                        <input type="text" id="login-username" class="form-input" placeholder="Enter your username" autocomplete="username">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span>üîí</span>
                            <span>Password</span>
                        </label>
                        <div class="password-container">
                            <input type="password" id="login-password" class="form-input" placeholder="Enter your password" autocomplete="current-password">
                            <button type="button" class="toggle-password" id="toggle-password">üëÅÔ∏è</button>
                        </div>
                    </div>
                    
                    <button id="login-btn" class="btn btn-primary">
                        <span>üîê</span>
                        <span>Login to Continue</span>
                    </button>
                    
                    <div id="login-error" class="error-message">
                        Invalid username or password. Please try again.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== SELECTION SCREEN ===== -->
    <div id="selection-screen" class="screen">
        <div class="container">
            <div class="selection-header">
                <h2>Welcome to <span class="user-name-highlight" id="display-user-name">Student</span>!</h2>
                <p class="welcome-message">Please select your class and subject to continue</p>
            </div>
            
            <div class="selection-grid">
                <!-- Class Cards -->
                <div class="selection-card" data-type="class" data-value="class8">
                    <div class="selection-icon">üéí</div>
                    <h3>Class 8</h3>
                    <p>For students studying in Class 8. Access Science and Mathematics chapters tailored for Class 8 curriculum.</p>
                </div>
                
                <div class="selection-card" data-type="class" data-value="class9">
                    <div class="selection-icon">üìö</div>
                    <h3>Class 9</h3>
                    <p>For students studying in Class 9. Comprehensive coverage of Class 9 Science and Mathematics syllabus.</p>
                </div>
                
                <div class="selection-card" data-type="class" data-value="class10">
                    <div class="selection-icon">üéì</div>
                    <h3>Class 10</h3>
                    <p>For students studying in Class 10. Prepare for board exams with detailed chapter-wise practice.</p>
                </div>
                
                <!-- Subject Cards -->
                <div class="selection-card" data-type="subject" data-value="science">
                    <div class="selection-icon">üî¨</div>
                    <h3>Science</h3>
                    <p>Physics, Chemistry, and Biology chapters with detailed explanations and MCQs for comprehensive learning.</p>
                </div>
                
                <div class="selection-card" data-type="subject" data-value="mathematics">
                    <div class="selection-icon">üìê</div>
                    <h3>Mathematics</h3>
                    <p>Algebra, Geometry, Arithmetic, and Statistics chapters with step-by-step solutions and practice questions.</p>
                </div>
            </div>
            
            <div class="selection-footer">
                <button id="continue-btn" class="btn btn-secondary btn-continue" disabled>
                    <span>üëâ</span>
                    <span>Continue to Chapters</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ===== QUIZ SCREEN ===== -->
    <div id="quiz-screen" class="screen">
        <div class="container">
            <div class="quiz-title-section">
                <h2 id="current-class-subject">Class 8 - Science</h2>
                <p class="quiz-subtitle">Select a chapter to start practicing</p>
            </div>
            
            <div class="chapters-grid" id="chapters-container">
                <!-- Chapters will be dynamically loaded here -->
                <div class="chapter-card">
                    <div class="chapter-header">
                        <div class="chapter-title">Loading Chapters...</div>
                        <div class="chapter-badge">Loading</div>
                    </div>
                    <div class="chapter-info">
                        <div class="info-item">üìù 0 questions</div>
                        <div class="info-item">‚è±Ô∏è 0 min</div>
                    </div>
                    <div class="chapter-description">
                        Please wait while we load the available chapters for your selected class and subject.
                    </div>
                    <button class="btn btn-primary btn-start-chapter" disabled>
                        <span>‚è≥</span>
                        <span>Loading...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== QUIZ QUESTION SCREEN ===== -->
    <div id="quiz-question-screen" class="screen">
        <div class="container">
            <div class="quiz-progress-container">
                <div class="progress-header">
                    <div class="progress-title">Chapter Quiz</div>
                    <div class="timer-container">
                        <span>‚è∞</span>
                        <span id="timer-display">00:00</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-info">
                    <span id="current-question-info">Question 0/0</span>
                    <span id="score-info">Score: 0</span>
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-header">
                    <div class="question-number" id="question-number">1</div>
                    <div class="question-chapter" id="question-chapter">Chapter: Loading...</div>
                </div>
                <div class="question-text" id="question-text">
                    Loading question...
                </div>
            </div>
            
            <div class="options-container" id="options-container">
                <!-- Options will be dynamically loaded here -->
            </div>
            
            <div class="explanation-box" id="explanation-box">
                <div class="explanation-title">
                    <span>üìù</span>
                    <span>Explanation</span>
                </div>
                <div class="explanation-text" id="explanation-text">
                    Loading explanation...
                </div>
            </div>
            
            <div class="quiz-controls">
                <button id="prev-btn" class="btn btn-outline">
                    <span>‚Üê</span>
                    <span>Previous</span>
                </button>
                <button id="next-btn" class="btn btn-outline">
                    <span>Next</span>
                    <span>‚Üí</span>
                </button>
                <button id="submit-btn" class="btn btn-primary">
                    <span>‚úì</span>
                    <span>Submit Answer</span>
                </button>
                <button id="finish-btn" class="btn btn-warning">
                    <span>üèÅ</span>
                    <span>Finish Quiz</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ===== RESULTS SCREEN ===== -->
    <div id="results-screen" class="screen">
        <div class="container">
            <div class="results-container">
                <div class="results-header">
                    <h2 class="results-title">Quiz Completed!</h2>
                    <p class="results-subtitle">Great effort! Here are your results</p>
                </div>
                
                <div class="score-display">
                    <div class="score-circle-container">
                        <div class="score-circle-bg" id="score-circle">
                            <div class="score-value" id="final-score">0</div>
                            <div class="score-percentage" id="final-percentage">0%</div>
                        </div>
                    </div>
                </div>
                
                <div class="results-stats" id="results-stats">
                    <!-- Stats will be dynamically loaded here -->
                </div>
                
                <div class="results-message" id="results-message">
                    <div class="message-text" id="message-text">Loading your performance analysis...</div>
                    <div class="message-subtext" id="message-subtext">Keep practicing to improve your score!</div>
                </div>
                
                <div class="results-actions">
                    <button id="retry-btn" class="btn btn-primary">
                        <span>üîÑ</span>
                        <span>Retry This Chapter</span>
                    </button>
                    <button id="new-chapter-btn" class="btn btn-secondary">
                        <span>üìö</span>
                        <span>Try Another Chapter</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let currentUser = null;
        let appData = null;
        let selectedClass = null;
        let selectedSubject = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;
        let totalQuestions = 0;
        let timeRemaining = 0;
        let timerInterval = null;
        let currentChapterFile = null;
        let currentChapterTitle = null;
        let quizStartTime = null;

        // ===== DOM ELEMENTS =====
        const screens = {
            login: document.getElementById('login-screen'),
            selection: document.getElementById('selection-screen'),
            quiz: document.getElementById('quiz-screen'),
            quizQuestion: document.getElementById('quiz-question-screen'),
            results: document.getElementById('results-screen')
        };

        const loader = document.getElementById('loader');
        const mainHeader = document.getElementById('main-header');
        const headerUserName = document.getElementById('header-user-name');
        const headerUserClass = document.getElementById('header-user-class');
        const headerLogoutBtn = document.getElementById('header-logout-btn');

        // Login screen elements
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const togglePasswordBtn = document.getElementById('toggle-password');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');

        // Selection screen elements
        const displayUserName = document.getElementById('display-user-name');
        const selectionCards = document.querySelectorAll('.selection-card');
        const continueBtn = document.getElementById('continue-btn');

        // Quiz screen elements
        const currentClassSubject = document.getElementById('current-class-subject');
        const chaptersContainer = document.getElementById('chapters-container');

        // Quiz question screen elements
        const timerDisplay = document.getElementById('timer-display');
        const progressFill = document.getElementById('progress-fill');
        const currentQuestionInfo = document.getElementById('current-question-info');
        const scoreInfo = document.getElementById('score-info');
        const questionNumber = document.getElementById('question-number');
        const questionChapter = document.getElementById('question-chapter');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const explanationBox = document.getElementById('explanation-box');
        const explanationText = document.getElementById('explanation-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const finishBtn = document.getElementById('finish-btn');

        // Results screen elements
        const scoreCircle = document.getElementById('score-circle');
        const finalScore = document.getElementById('final-score');
        const finalPercentage = document.getElementById('final-percentage');
        const resultsStats = document.getElementById('results-stats');
        const messageText = document.getElementById('message-text');
        const messageSubtext = document.getElementById('message-subtext');
        const retryBtn = document.getElementById('retry-btn');
        const newChapterBtn = document.getElementById('new-chapter-btn');

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async function() {
            showLoader();
            
            try {
                // Load app data
                appData = {
                    "classes": [
                        {
                            "id": "class8",
                            "name": "Class 8",
                            "subjects": [
                                {
                                    "id": "science",
                                    "name": "Science",
                                    "chapters": [
                                        {
                                            "name": "Crop Production and Management",
                                            "file": "chapters/class8/science/chapter1.xml",
                                            "description": "Learn about agricultural practices, crop types, and modern farming techniques.",
                                            "questions": 15,
                                            "time_limit": 30,
                                            "difficulty": "Easy"
                                        },
                                        {
                                            "name": "Microorganisms: Friend and Foe",
                                            "file": "chapters/class8/science/chapter2.xml",
                                            "description": "Explore the world of microorganisms and their role in our lives.",
                                            "questions": 20,
                                            "time_limit": 35,
                                            "difficulty": "Medium"
                                        },
                                        {
                                            "name": "Light",
                                            "file": "chapters/class8/science/chapter3.xml",
                                            "description": "Understand reflection, refraction, and properties of light.",
                                            "questions": 18,
                                            "time_limit": 40,
                                            "difficulty": "Medium"
                                        }
                                    ]
                                },
                                {
                                    "id": "mathematics",
                                    "name": "Mathematics",
                                    "chapters": [
                                        {
                                            "name": "Rational Numbers",
                                            "file": "chapters/class8/maths/chapter1.xml",
                                            "description": "Learn about rational numbers, their properties and operations.",
                                            "questions": 20,
                                            "time_limit": 40,
                                            "difficulty": "Easy"
                                        },
                                        {
                                            "name": "Linear Equations in One Variable",
                                            "file": "chapters/class8/maths/chapter2.xml",
                                            "description": "Solve linear equations and word problems.",
                                            "questions": 25,
                                            "time_limit": 45,
                                            "difficulty": "Medium"
                                        },
                                        {
                                            "name": "Understanding Quadrilaterals",
                                            "file": "chapters/class8/maths/chapter3.xml",
                                            "description": "Properties and types of quadrilaterals.",
                                            "questions": 18,
                                            "time_limit": 35,
                                            "difficulty": "Medium"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "class9",
                            "name": "Class 9",
                            "subjects": [
                                {
                                    "id": "science",
                                    "name": "Science",
                                    "chapters": [
                                        {
                                            "name": "Matter in Our Surroundings",
                                            "file": "chapters/class9/science/chapter1.xml",
                                            "description": "States of matter and their interconversion.",
                                            "questions": 20,
                                            "time_limit": 35,
                                            "difficulty": "Easy"
                                        },
                                        {
                                            "name": "Force and Laws of Motion",
                                            "file": "chapters/class9/science/chapter2.xml",
                                            "description": "Newton's laws of motion and their applications.",
                                            "questions": 25,
                                            "time_limit": 45,
                                            "difficulty": "Medium"
                                        },
                                        {
                                            "name": "Atoms and Molecules",
                                            "file": "chapters/class9/science/chapter3.xml",
                                            "description": "Basic concepts of atoms, molecules and chemical formulas.",
                                            "questions": 22,
                                            "time_limit": 40,
                                            "difficulty": "Hard"
                                        }
                                    ]
                                },
                                {
                                    "id": "mathematics",
                                    "name": "Mathematics",
                                    "chapters": [
                                        {
                                            "name": "Number Systems",
                                            "file": "chapters/class9/maths/chapter1.xml",
                                            "description": "Real numbers, irrational numbers and their properties.",
                                            "questions": 25,
                                            "time_limit": 45,
                                            "difficulty": "Medium"
                                        },
                                        {
                                            "name": "Polynomials",
                                            "file": "chapters/class9/maths/chapter2.xml",
                                            "description": "Types of polynomials and their factorization.",
                                            "questions": 20,
                                            "time_limit": 40,
                                            "difficulty": "Medium"
                                        },
                                        {
                                            "name": "Coordinate Geometry",
                                            "file": "chapters/class9/maths/chapter3.xml",
                                            "description": "Cartesian system and plotting points.",
                                            "questions": 18,
                                            "time_limit": 35,
                                            "difficulty": "Easy"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "class10",
                            "name": "Class 10",
                            "subjects": [
                                {
                                    "id": "science",
                                    "name": "Science",
                                    "chapters": [
                                        {
                                            "name": "Chemical Reactions and Equations",
                                            "file": "chapters/class10/science/chapter1.xml",
                                            "description": "Types of chemical reactions and balancing equations.",
                                            "questions": 25,
                                            "time_limit": 45,
                                            "difficulty": "Medium"
                                        },
                                        {
                                            "name": "Electricity",
                                            "file": "chapters/class10/science/chapter2.xml",
                                            "description": "Electric current, circuits and Ohm's law.",
                                            "questions": 30,
                                            "time_limit": 50,
                                            "difficulty": "Hard"
                                        },
                                        {
                                            "name": "Life Processes",
                                            "file": "chapters/class10/science/chapter3.xml",
                                            "description": "Nutrition, respiration and other life processes.",
                                            "questions": 28,
                                            "time_limit": 48,
                                            "difficulty": "Medium"
                                        }
                                    ]
                                },
                                {
                                    "id": "mathematics",
                                    "name": "Mathematics",
                                    "chapters": [
                                        {
                                            "name": "Real Numbers",
                                            "file": "chapters/class10/maths/chapter1.xml",
                                            "description": "Euclid's division lemma and fundamental theorem of arithmetic.",
                                            "questions": 25,
                                            "time_limit": 45,
                                            "difficulty": "Medium"
                                        },
                                        {
                                            "name": "Quadratic Equations",
                                            "file": "chapters/class10/maths/chapter2.xml",
                                            "description": "Solving quadratic equations using various methods.",
                                            "questions": 30,
                                            "time_limit": 50,
                                            "difficulty": "Hard"
                                        },
                                        {
                                            "name": "Triangles",
                                            "file": "chapters/class10/maths/chapter3.xml",
                                            "description": "Similarity criteria and properties of triangles.",
                                            "questions": 22,
                                            "time_limit": 42,
                                            "difficulty": "Medium"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                };
                
                // Initialize the app
                initializeApp();
                hideLoader();
            } catch (error) {
                console.error('Initialization error:', error);
                showError('Failed to load app data. Please refresh the page.');
                hideLoader();
            }
        });

        function initializeApp() {
            // Set up event listeners
            setupEventListeners();
            
            // Focus on username field
            loginUsername.focus();
            
            console.log('G.S. Tutorial App initialized successfully');
        }

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            // Login screen
            loginBtn.addEventListener('click', handleLogin);
            loginPassword.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            togglePasswordBtn.addEventListener('click', togglePasswordVisibility);

            // Header logout button
            headerLogoutBtn.addEventListener('click', handleLogout);

            // Selection screen
            selectionCards.forEach(card => {
                card.addEventListener('click', handleSelectionCardClick);
            });
            continueBtn.addEventListener('click', goToQuizScreen);

            // Quiz question screen
            prevBtn.addEventListener('click', goToPreviousQuestion);
            nextBtn.addEventListener('click', goToNextQuestion);
            submitBtn.addEventListener('click', submitAnswer);
            finishBtn.addEventListener('click', finishQuiz);

            // Results screen
            retryBtn.addEventListener('click', retryQuiz);
            newChapterBtn.addEventListener('click', () => switchScreen('quiz'));
        }

        // ===== SCREEN MANAGEMENT =====
        function switchScreen(screenName) {
            // Hide all screens
            Object.values(screens).forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            screens[screenName].classList.add('active');
            
            // Show/hide header based on screen
            if (screenName === 'login') {
                mainHeader.style.display = 'none';
            } else {
                mainHeader.style.display = 'block';
            }
            
            // Special actions for specific screens
            switch(screenName) {
                case 'selection':
                    resetSelection();
                    break;
                case 'quiz':
                    loadChaptersForSelection();
                    break;
                case 'quizQuestion':
                    startQuizTimer();
                    break;
                case 'results':
                    updateResultsScreen();
                    break;
            }
        }

        // ===== LOADER FUNCTIONS =====
        function showLoader(message = 'Loading...') {
            loader.querySelector('.loader-text').textContent = message;
            loader.classList.add('active');
        }

        function hideLoader() {
            loader.classList.remove('active');
        }

        // ===== LOGIN FUNCTIONS =====
        async function handleLogin() {
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();

            if (!username || !password) {
                showLoginError('Please enter both username and password');
                return;
            }

            showLoader('Authenticating...');
            
            try {
                // Predefined users (removed test accounts from UI)
                const users = [
                    { username: 'student8', password: 'pass123', name: 'Rahul Sharma', class: '8', role: 'student' },
                    { username: 'student9', password: 'pass456', name: 'Priya Patel', class: '9', role: 'student' },
                    { username: 'student10', password: 'pass789', name: 'Amit Kumar', class: '10', role: 'student' },
                    { username: 'teacher1', password: 'teacher123', name: 'Mr. Gupta', class: '10', role: 'teacher' },
                    { username: 'admin', password: 'admin123', name: 'Administrator', class: '10', role: 'admin' }
                ];

                // Find user
                const userFound = users.find(user => 
                    user.username === username && user.password === password
                );

                if (userFound) {
                    currentUser = userFound;
                    hideLoginError();
                    
                    // Update UI
                    displayUserName.textContent = currentUser.name;
                    headerUserName.textContent = currentUser.name;
                    headerUserClass.textContent = `Class ${currentUser.class}`;
                    
                    // Auto-select class based on user's class
                    const userClassId = `class${currentUser.class}`;
                    const classCard = document.querySelector(`[data-value="${userClassId}"]`);
                    if (classCard) {
                        selectCard(classCard);
                    }
                    
                    // Switch to selection screen
                    switchScreen('selection');
                    
                    console.log('Login successful:', currentUser);
                } else {
                    showLoginError('Invalid username or password');
                }
            } catch (error) {
                console.error('Login error:', error);
                showLoginError('Error during authentication.');
            } finally {
                hideLoader();
            }
        }

        function togglePasswordVisibility() {
            const passwordField = loginPassword;
            const type = passwordField.type === 'password' ? 'text' : 'password';
            passwordField.type = type;
            togglePasswordBtn.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è';
        }

        function showLoginError(message) {
            loginError.textContent = message;
            loginError.style.display = 'block';
            loginPassword.focus();
            loginPassword.select();
        }

        function hideLoginError() {
            loginError.style.display = 'none';
        }

        // ===== SELECTION SCREEN FUNCTIONS =====
        function handleSelectionCardClick(event) {
            const card = event.currentTarget;
            selectCard(card);
        }

        function selectCard(card) {
            const type = card.dataset.type;
            const value = card.dataset.value;
            
            // Deselect other cards of the same type
            document.querySelectorAll(`[data-type="${type}"]`).forEach(c => {
                c.classList.remove('selected');
            });
            
            // Select clicked card
            card.classList.add('selected');
            
            // Update selection
            if (type === 'class') {
                selectedClass = value;
            } else if (type === 'subject') {
                selectedSubject = value;
            }
            
            // Update continue button state
            updateContinueButton();
        }

        function updateContinueButton() {
            continueBtn.disabled = !(selectedClass && selectedSubject);
        }

        function resetSelection() {
            // Only reset class/subject selection, keep user selection
            const classCard = document.querySelector(`[data-value="${selectedClass}"]`);
            const subjectCard = document.querySelector(`[data-value="${selectedSubject}"]`);
            
            if (classCard) classCard.classList.add('selected');
            if (subjectCard) subjectCard.classList.add('selected');
            
            updateContinueButton();
        }

        function goToQuizScreen() {
            if (!selectedClass || !selectedSubject) return;
            
            // Update quiz screen title
            const classObj = appData.classes.find(c => c.id === selectedClass);
            const subjectObj = classObj.subjects.find(s => s.id === selectedSubject);
            currentClassSubject.textContent = `${classObj.name} - ${subjectObj.name}`;
            
            switchScreen('quiz');
        }

        // ===== QUIZ SCREEN FUNCTIONS =====
        async function loadChaptersForSelection() {
            if (!selectedClass || !selectedSubject) return;
            
            showLoader('Loading chapters...');
            
            try {
                const classObj = appData.classes.find(c => c.id === selectedClass);
                const subjectObj = classObj.subjects.find(s => s.id === selectedSubject);
                
                chaptersContainer.innerHTML = '';
                
                if (!subjectObj.chapters || subjectObj.chapters.length === 0) {
                    chaptersContainer.innerHTML = `
                        <div class="chapter-card">
                            <div class="chapter-header">
                                <div class="chapter-title">No Chapters Available</div>
                                <div class="chapter-badge">Coming Soon</div>
                            </div>
                            <div class="chapter-info">
                                <div class="info-item">üìù 0 questions</div>
                                <div class="info-item">‚è±Ô∏è 0 min</div>
                            </div>
                            <div class="chapter-description">
                                Chapters for ${subjectObj.name} in ${classObj.name} will be added soon. Please check back later.
                            </div>
                            <button class="btn btn-primary btn-start-chapter" disabled>
                                <span>‚è≥</span>
                                <span>Coming Soon</span>
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Create chapter cards
                subjectObj.chapters.forEach(chapter => {
                    const chapterCard = document.createElement('div');
                    chapterCard.className = 'chapter-card';
                    chapterCard.innerHTML = `
                        <div class="chapter-header">
                            <div class="chapter-title">${chapter.name}</div>
                            <div class="chapter-badge">${chapter.difficulty || 'Medium'}</div>
                        </div>
                        <div class="chapter-info">
                            <div class="info-item">üìù ${chapter.questions || '15'} questions</div>
                            <div class="info-item">‚è±Ô∏è ${chapter.time_limit || '30'} min</div>
                            <div class="info-item">üéØ ${chapter.difficulty || 'Medium'}</div>
                        </div>
                        <div class="chapter-description">
                            ${chapter.description || 'Practice questions from this chapter to test your knowledge and improve your skills.'}
                        </div>
                        <button class="btn btn-primary btn-start-chapter" onclick="startChapterQuiz('${chapter.file}', '${chapter.name}')">
                            <span>‚ñ∂</span>
                            <span>Start Practice</span>
                        </button>
                    `;
                    chaptersContainer.appendChild(chapterCard);
                });
                
            } catch (error) {
                console.error('Error loading chapters:', error);
                chaptersContainer.innerHTML = `
                    <div class="chapter-card">
                        <div class="chapter-header">
                            <div class="chapter-title">Error Loading Chapters</div>
                            <div class="chapter-badge">Error</div>
                        </div>
                        <div class="chapter-description">
                            Failed to load chapters. Please check your internet connection and try again.
                        </div>
                        <button class="btn btn-danger btn-start-chapter" onclick="loadChaptersForSelection()">
                            <span>üîÑ</span>
                            <span>Retry Loading</span>
                        </button>
                    </div>
                `;
            } finally {
                hideLoader();
            }
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear all data
                currentUser = null;
                selectedClass = null;
                selectedSubject = null;
                currentQuestions = [];
                userAnswers = [];
                score = 0;
                
                // Stop timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                
                // Reset form
                loginUsername.value = '';
                loginPassword.value = '';
                
                // Switch to login screen
                switchScreen('login');
            }
        }

        // ===== QUIZ FUNCTIONS =====
        async function startChapterQuiz(chapterFile, chapterTitle) {
            showLoader('Loading quiz...');
            
            try {
                // Generate sample questions for demo (since XML files don't exist)
                generateSampleQuestions(chapterTitle);
                
                // Update UI
                questionChapter.textContent = `Chapter: ${chapterTitle}`;
                
                // Start quiz
                switchScreen('quizQuestion');
                loadQuestion();
                
            } catch (error) {
                console.error('Error starting quiz:', error);
                alert(`Error loading quiz: ${error.message}`);
            } finally {
                hideLoader();
            }
        }

        function generateSampleQuestions(chapterTitle) {
            // Generate sample questions for demonstration
            currentQuestions = [];
            const subjects = {
                'Crop Production and Management': [
                    "Which agricultural practice involves turning and loosening of soil?",
                    "What is the process of supplying water to crops at regular intervals called?",
                    "Which farming method uses organic manure and natural pesticides?"
                ],
                'Microorganisms: Friend and Foe': [
                    "Which microorganism is used in making bread?",
                    "What disease is caused by a protozoan?",
                    "Which bacteria helps in nitrogen fixation?"
                ],
                'Light': [
                    "What is the bouncing back of light when it strikes a surface called?",
                    "Which mirror always forms a virtual, erect and diminished image?",
                    "What is the splitting of white light into seven colors called?"
                ],
                'Rational Numbers': [
                    "What is the additive inverse of -5/7?",
                    "Which property states that a √ó b = b √ó a?",
                    "What is the multiplicative identity for rational numbers?"
                ]
            };

            const sampleQuestions = subjects[chapterTitle] || [
                "What is the capital of France?",
                "Which planet is known as the Red Planet?",
                "What is the chemical symbol for water?"
            ];

            const optionsList = [
                ["Tilling", "Ploughing", "Leveling", "Harvesting"],
                ["Harvesting", "Irrigation", "Sowing", "Weeding"],
                ["Organic farming", "Hydroponics", "Mixed farming", "Intensive farming"],
                ["Yeast", "Bacteria", "Virus", "Protozoa"],
                ["Malaria", "Typhoid", "Cholera", "Tuberculosis"],
                ["Rhizobium", "E.coli", "Salmonella", "Lactobacillus"],
                ["Reflection", "Refraction", "Dispersion", "Scattering"],
                ["Concave mirror", "Convex mirror", "Plane mirror", "Spherical mirror"],
                ["Reflection", "Refraction", "Dispersion", "Scattering"],
                ["5/7", "-5/7", "7/5", "-7/5"],
                ["Commutative", "Associative", "Distributive", "Identity"],
                ["0", "1", "-1", "The number itself"]
            ];

            sampleQuestions.forEach((question, index) => {
                const qIndex = Math.min(index, optionsList.length - 1);
                currentQuestions.push({
                    text: question,
                    options: optionsList[qIndex],
                    correctIndex: 0,
                    explanation: "This is a sample explanation for demonstration purposes. In the actual application, this would contain detailed information about the correct answer."
                });
            });
            
            // Reset quiz state
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuestions.length).fill(null);
            score = 0;
            totalQuestions = currentQuestions.length;
            timeRemaining = 30 * 60; // 30 minutes
            currentChapterFile = chapterFile;
            currentChapterTitle = chapterTitle;
            quizStartTime = Date.now();
        }

        function startQuizTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    finishQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update timer color based on remaining time
            if (timeRemaining <= 300) { // 5 minutes
                timerDisplay.classList.add('timer-warning');
                timerDisplay.classList.remove('timer-critical');
            }
            if (timeRemaining <= 60) { // 1 minute
                timerDisplay.classList.remove('timer-warning');
                timerDisplay.classList.add('timer-critical');
            }
        }

        function loadQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                finishQuiz();
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            
            // Update progress
            const progressPercent = ((currentQuestionIndex) / currentQuestions.length) * 100;
            progressFill.style.width = `${progressPercent}%`;
            
            // Update question info
            questionNumber.textContent = currentQuestionIndex + 1;
            currentQuestionInfo.textContent = `Question ${currentQuestionIndex + 1}/${currentQuestions.length}`;
            scoreInfo.textContent = `Score: ${score}`;
            questionText.textContent = question.text;
            
            // Clear previous options and explanation
            optionsContainer.innerHTML = '';
            explanationBox.style.display = 'none';
            
            // Add options
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                if (userAnswers[currentQuestionIndex] === index) {
                    optionDiv.classList.add('selected');
                }
                
                optionDiv.innerHTML = `
                    <div class="option-label">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionDiv.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update button states
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === currentQuestions.length - 1;
            submitBtn.disabled = userAnswers[currentQuestionIndex] !== null;
            finishBtn.disabled = false;
            
            // Show explanation if already answered
            if (userAnswers[currentQuestionIndex] !== null) {
                showAnswerFeedback();
            }
        }

        function selectOption(index) {
            userAnswers[currentQuestionIndex] = index;
            loadQuestion();
        }

        function showAnswerFeedback() {
            const question = currentQuestions[currentQuestionIndex];
            const selectedIndex = userAnswers[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correctIndex;
            
            // Highlight correct/incorrect options
            const options = optionsContainer.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === question.correctIndex) {
                    option.classList.add('correct');
                } else if (index === selectedIndex && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
            
            // Show explanation
            explanationText.textContent = question.explanation;
            explanationBox.style.display = 'block';
            
            // Update submit button
            submitBtn.disabled = true;
        }

        function submitAnswer() {
            if (userAnswers[currentQuestionIndex] === null) {
                alert('Please select an answer first.');
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            const selectedIndex = userAnswers[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correctIndex;
            
            if (isCorrect) {
                score++;
                scoreInfo.textContent = `Score: ${score}`;
            }
            
            showAnswerFeedback();
        }

        function goToPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function goToNextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function finishQuiz() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            switchScreen('results');
        }

        // ===== RESULTS SCREEN FUNCTIONS =====
        function updateResultsScreen() {
            // Calculate statistics
            const total = currentQuestions.length;
            const correct = score;
            const incorrect = total - correct;
            const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
            const timeTaken = quizStartTime ? Math.floor((Date.now() - quizStartTime) / 1000) : 0;
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            // Update score circle
            scoreCircle.style.setProperty('--percentage', `${percentage}%`);
            finalScore.textContent = correct;
            finalPercentage.textContent = `${percentage}%`;
            
            // Update statistics
            resultsStats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${total}</div>
                    <div class="stat-label">Total Questions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${correct}</div>
                    <div class="stat-label">Correct Answers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${incorrect}</div>
                    <div class="stat-label">Incorrect Answers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                    <div class="stat-label">Time Taken</div>
                </div>
            `;
            
            // Update message based on performance
            let message, submessage;
            if (percentage >= 90) {
                message = "üéâ Outstanding Performance!";
                submessage = "You have mastered this chapter! Excellent work!";
            } else if (percentage >= 75) {
                message = "üëç Very Good!";
                submessage = "You have a strong understanding of this chapter. Keep it up!";
            } else if (percentage >= 60) {
                message = "üìö Good Effort!";
                submessage = "You understand the basics well. Review the explanations to improve.";
            } else if (percentage >= 40) {
                message = "üí° Room for Improvement";
                submessage = "Review the chapter material and explanations carefully.";
            } else {
                message = "üìñ Needs More Practice";
                submessage = "Take your time to study the chapter thoroughly before trying again.";
            }
            
            messageText.textContent = message;
            messageSubtext.textContent = submessage;
        }

        function retryQuiz() {
            // Reset quiz state
            currentQuestionIndex = 0;
            userAnswers.fill(null);
            score = 0;
            
            // Restart quiz
            switchScreen('quizQuestion');
            loadQuestion();
            startQuizTimer();
        }

        // ===== UTILITY FUNCTIONS =====
        function showError(message) {
            alert(`Error: ${message}`);
        }

        // Make functions available globally for onclick handlers
        window.startChapterQuiz = startChapterQuiz;
    </script>
</body>
</html>
